# 小久任务管理系统 v4.2.2.1 部署指南

## 📋 部署方式概述

本系统提供多种部署方式，可根据需求选择最适合的方式：

1. **自动部署到服务器** - 通过PowerShell脚本自动上传并部署到服务器
2. **手动部署到服务器** - 创建部署包后手动上传到服务器（推荐）
3. **Git部署** - 通过Git提交并推送到GitHub/Vercel等平台
4. **仅创建部署包** - 只创建部署包，不执行部署操作

## 🚀 快速开始

### 方式1：使用一键部署脚本

最简单的方式是使用一键部署脚本，它会引导您完成整个部署过程：

1. 双击运行 `deploy/一键部署-v4.2.2.1.bat`
2. 从菜单中选择您需要的部署方式
3. 按照屏幕提示完成部署

### 方式2：单独使用各部署脚本

您也可以直接使用特定的部署脚本：

- `部署到服务器-v4.2.2.1.bat` - 手动部署到服务器
- `Git部署-v4.2.2.1.bat` - Git部署
- `快速部署-v4.2.2.1.bat` - 简化版部署脚本

## 📦 部署包说明

部署脚本会自动创建一个名为 `task-manager-v4.2.2.1-complete.zip` 的完整部署包，包含以下内容：

- HTML文件 (index.html, sync-test.html等)
- CSS文件 (css目录)
- JavaScript文件 (js目录)
- API文件 (api目录)
- 数据文件 (data目录)

## 🔧 服务器部署详细步骤

### 自动部署

1. 运行 `一键部署-v4.2.2.1.bat` 并选择选项1
2. 输入服务器密码
3. 脚本会自动下载必要的工具、上传部署包并在服务器上执行部署命令

### 手动部署（推荐）

1. 运行 `一键部署-v4.2.2.1.bat` 并选择选项2
2. 脚本会创建部署包 `task-manager-v4.2.2.1-complete.zip`
3. 使用以下方法之一上传部署包：
   - **宝塔面板**（推荐）：
     - 登录宝塔面板 (http://115.159.5.111:8888)
     - 进入文件管理器
     - 上传部署包到 `/www/wwwroot/`
     - 解压到 `/www/wwwroot/task-manager/`
     - 设置权限：所有者 www，权限 755
   - **FTP工具**：
     - 使用FileZilla等FTP工具连接服务器
     - 上传部署包到 `/www/wwwroot/`
     - 通过SSH执行解压和权限设置命令

4. 服务器上的命令（通过SSH或宝塔终端执行）：
   ```bash
   cd /www/wwwroot/
   unzip -o task-manager-v4.2.2.1-complete.zip -d task-manager/
   chown -R www:www task-manager/
   chmod -R 755 task-manager/
   ```

## 🌐 Git部署步骤

1. 运行 `一键部署-v4.2.2.1.bat` 并选择选项3
2. 脚本会自动提交代码并推送到远程仓库
3. 如果配置了GitHub Pages或Vercel，它们会自动部署更新的代码

## 🧪 部署后测试

部署完成后，请执行以下测试以确保系统正常工作：

### 1. 基础功能测试
- 访问 `http://115.159.5.111/`
- 检查页面是否正常加载
- 添加几个任务并完成

### 2. 跨浏览器同步测试
- 在Chrome中完成一些任务
- 在Firefox中打开同一地址
- 等待3-5秒观察自动同步
- 检查任务状态是否同步

### 3. 诊断测试
- 访问 `http://115.159.5.111/sync-test.html`
- 点击"运行诊断"查看同步状态
- 如有问题，点击"自动修复"

### 4. 跨设备测试
- 在手机浏览器中访问
- 在不同电脑的浏览器中访问
- 验证数据是否在所有设备间同步

## 📊 v4.2.2.1 版本特性

- ✅ 跨浏览器数据同步 - 彻底修复
- ✅ 实时数据同步 - 3秒内完成
- ✅ 智能错误恢复 - 自动修复机制
- ✅ 本地存储监听 - 即时触发同步
- ✅ 可视化诊断 - 问题排查利器
- ✅ 简化部署流程 - 一个文件搞定
- ✅ 增强部署脚本 - 更稳定可靠

## 🔍 故障排除

如果遇到部署问题，请尝试以下步骤：

1. **同步问题**：访问 `sync-test.html` 页面，运行诊断并使用自动修复功能
2. **权限问题**：确保服务器上的文件权限正确（所有者 www，权限 755）
3. **文件缺失**：检查部署包是否完整，必要时重新创建部署包
4. **服务器错误**：检查服务器日志，确保PHP和Web服务器配置正确

## 📞 支持与帮助

如需进一步帮助，请联系系统管理员或开发团队。

## 🆕 v4.2.2.1 更新内容

此版本主要修复了部署脚本中的问题：

1. 修复了文件复制过程中的错误处理
2. 增强了文件和目录检查机制
3. 改进了字符编码处理
4. 优化了部署流程的稳定性
5. 增加了更详细的错误提示和日志记录