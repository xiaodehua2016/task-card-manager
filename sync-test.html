<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®åŒæ­¥æµ‹è¯• - å°ä¹…ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ v4.2.3</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/sync-test.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icon-192.svg" type="image/svg+xml">
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background-color: #f5f7fa;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .test-section h2 {
            margin-top: 0;
            color: #3498db;
            font-size: 1.2em;
        }
        .test-result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
            background-color: #f0f0f0;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .btn {
            display: inline-block;
            padding: 8px 16px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #2980b9;
        }
        .btn-danger {
            background-color: #e74c3c;
        }
        .btn-danger:hover {
            background-color: #c0392b;
        }
        .btn-success {
            background-color: #2ecc71;
        }
        .btn-success:hover {
            background-color: #27ae60;
        }
        .btn-warning {
            background-color: #f39c12;
        }
        .btn-warning:hover {
            background-color: #d35400;
        }
        .nav-links {
            text-align: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        .nav-links a {
            margin: 0 10px;
            color: #3498db;
            text-decoration: none;
        }
        .nav-links a:hover {
            text-decoration: underline;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .status-online {
            background-color: #2ecc71;
        }
        .status-offline {
            background-color: #e74c3c;
        }
        .progress-container {
            width: 100%;
            background-color: #f1f1f1;
            border-radius: 5px;
            margin: 10px 0;
        }
        .progress-bar {
            height: 20px;
            background-color: #3498db;
            border-radius: 5px;
            width: 0%;
            transition: width 0.3s;
            text-align: center;
            line-height: 20px;
            color: white;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æ•°æ®åŒæ­¥æµ‹è¯• <small>v4.2.3</small></h1>
        
        <div class="test-section">
            <h2>ç³»ç»ŸçŠ¶æ€</h2>
            <div>
                <span class="status-indicator" id="online-status"></span>
                <span id="connection-status">æ£€æŸ¥ç½‘ç»œè¿æ¥...</span>
            </div>
            <div>
                <span>ä¸Šæ¬¡åŒæ­¥æ—¶é—´: </span>
                <span id="last-sync-time">ä»æœªåŒæ­¥</span>
            </div>
            <div>
                <span>æœ¬åœ°æ•°æ®ç‰ˆæœ¬: </span>
                <span id="local-version">æœªçŸ¥</span>
            </div>
        </div>
        
        <div class="test-section">
            <h2>åŒæ­¥è¯Šæ–­</h2>
            <button id="run-diagnostic" class="btn">è¿è¡Œè¯Šæ–­</button>
            <button id="force-sync" class="btn btn-warning">å¼ºåˆ¶åŒæ­¥</button>
            <button id="auto-fix" class="btn btn-success">è‡ªåŠ¨ä¿®å¤</button>
            <div class="progress-container" id="progress-container" style="display: none;">
                <div class="progress-bar" id="progress-bar">0%</div>
            </div>
            <div class="test-result" id="diagnostic-result"></div>
        </div>
        
        <div class="test-section">
            <h2>æ•°æ®ä¸€è‡´æ€§æµ‹è¯•</h2>
            <button id="check-consistency" class="btn">æ£€æŸ¥ä¸€è‡´æ€§</button>
            <button id="repair-data" class="btn btn-warning">ä¿®å¤æ•°æ®</button>
            <div class="test-result" id="consistency-result"></div>
        </div>
        
        <div class="test-section">
            <h2>é«˜çº§é€‰é¡¹</h2>
            <button id="clear-local-data" class="btn btn-danger">æ¸…é™¤æœ¬åœ°æ•°æ®</button>
            <button id="reset-sync" class="btn btn-danger">é‡ç½®åŒæ­¥çŠ¶æ€</button>
            <button id="export-debug" class="btn">å¯¼å‡ºè°ƒè¯•ä¿¡æ¯</button>
            <div class="test-result" id="advanced-result"></div>
        </div>
        
        <div class="nav-links">
            <a href="index.html">è¿”å›é¦–é¡µ</a> |
            <a href="today-tasks.html">ä»Šæ—¥ä»»åŠ¡</a> |
            <a href="edit-tasks.html">ç¼–è¾‘ä»»åŠ¡</a>
        </div>
    </div>

    <script src="js/cross-browser-sync.js"></script>
    <script>
        // åŒæ­¥æµ‹è¯•é¡µé¢è„šæœ¬
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–å˜é‡
            const syncManager = window.syncManager || new CrossBrowserSyncManager();
            const dataFixer = window.dataFixer || { fixAllIssues: () => console.log('æ•°æ®ä¿®å¤å™¨æœªåŠ è½½') };
            
            // æ›´æ–°åœ¨çº¿çŠ¶æ€
            function updateOnlineStatus() {
                const isOnline = navigator.onLine;
                const statusIndicator = document.getElementById('online-status');
                const statusText = document.getElementById('connection-status');
                
                if (isOnline) {
                    statusIndicator.className = 'status-indicator status-online';
                    statusText.textContent = 'åœ¨çº¿ - å¯ä»¥åŒæ­¥';
                } else {
                    statusIndicator.className = 'status-indicator status-offline';
                    statusText.textContent = 'ç¦»çº¿ - æ— æ³•åŒæ­¥';
                }
            }
            
            // æ›´æ–°åŒæ­¥æ—¶é—´
            function updateSyncTime() {
                const lastSyncTime = localStorage.getItem('lastSyncTime');
                const syncTimeElement = document.getElementById('last-sync-time');
                
                if (lastSyncTime) {
                    const date = new Date(parseInt(lastSyncTime));
                    syncTimeElement.textContent = date.toLocaleString();
                } else {
                    syncTimeElement.textContent = 'ä»æœªåŒæ­¥';
                }
            }
            
            // æ›´æ–°æœ¬åœ°ç‰ˆæœ¬
            function updateLocalVersion() {
                const data = localStorage.getItem('taskManagerData');
                const versionElement = document.getElementById('local-version');
                
                if (data) {
                    try {
                        const parsedData = JSON.parse(data);
                        versionElement.textContent = parsedData.version || 'æœªçŸ¥';
                    } catch (e) {
                        versionElement.textContent = 'æ•°æ®æ ¼å¼é”™è¯¯';
                    }
                } else {
                    versionElement.textContent = 'æ— æœ¬åœ°æ•°æ®';
                }
            }
            
            // è¿è¡Œè¯Šæ–­
            async function runDiagnostic() {
                const resultElement = document.getElementById('diagnostic-result');
                const progressContainer = document.getElementById('progress-container');
                const progressBar = document.getElementById('progress-bar');
                
                resultElement.className = 'test-result';
                resultElement.textContent = 'æ­£åœ¨è¿è¡Œè¯Šæ–­...\n';
                progressContainer.style.display = 'block';
                progressBar.style.width = '10%';
                progressBar.textContent = '10%';
                
                // æ£€æŸ¥ç½‘ç»œè¿æ¥
                resultElement.textContent += '1. æ£€æŸ¥ç½‘ç»œè¿æ¥...\n';
                await new Promise(resolve => setTimeout(resolve, 500));
                progressBar.style.width = '20%';
                progressBar.textContent = '20%';
                
                if (navigator.onLine) {
                    resultElement.textContent += '   âœ… ç½‘ç»œè¿æ¥æ­£å¸¸\n';
                } else {
                    resultElement.textContent += '   âŒ ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼Œæ— æ³•åŒæ­¥\n';
                    resultElement.className = 'test-result error';
                    progressBar.style.width = '100%';
                    progressBar.textContent = 'å¤±è´¥';
                    return;
                }
                
                // æ£€æŸ¥æœ¬åœ°å­˜å‚¨
                resultElement.textContent += '2. æ£€æŸ¥æœ¬åœ°å­˜å‚¨...\n';
                await new Promise(resolve => setTimeout(resolve, 500));
                progressBar.style.width = '40%';
                progressBar.textContent = '40%';
                
                const data = localStorage.getItem('taskManagerData');
                if (data) {
                    try {
                        const parsedData = JSON.parse(data);
                        resultElement.textContent += '   âœ… æœ¬åœ°æ•°æ®æ ¼å¼æ­£ç¡®\n';
                        resultElement.textContent += `   ğŸ“Š ä»»åŠ¡æ•°é‡: ${parsedData.tasks ? parsedData.tasks.length : 0}\n`;
                    } catch (e) {
                        resultElement.textContent += '   âŒ æœ¬åœ°æ•°æ®æ ¼å¼é”™è¯¯\n';
                        resultElement.className = 'test-result error';
                    }
                } else {
                    resultElement.textContent += '   âš ï¸ æ— æœ¬åœ°æ•°æ®\n';
                    resultElement.className = 'test-result warning';
                }
                
                // æµ‹è¯•åŒæ­¥åŠŸèƒ½
                resultElement.textContent += '3. æµ‹è¯•åŒæ­¥åŠŸèƒ½...\n';
                await new Promise(resolve => setTimeout(resolve, 500));
                progressBar.style.width = '60%';
                progressBar.textContent = '60%';
                
                try {
                    await syncManager.syncNow();
                    resultElement.textContent += '   âœ… åŒæ­¥åŠŸèƒ½æ­£å¸¸\n';
                    updateSyncTime();
                } catch (e) {
                    resultElement.textContent += `   âŒ åŒæ­¥åŠŸèƒ½å¼‚å¸¸: ${e.message}\n`;
                    resultElement.className = 'test-result error';
                }
                
                // æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§
                resultElement.textContent += '4. æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§...\n';
                await new Promise(resolve => setTimeout(resolve, 500));
                progressBar.style.width = '80%';
                progressBar.textContent = '80%';
                
                // è¿™é‡Œåº”è¯¥æœ‰æ›´å¤æ‚çš„ä¸€è‡´æ€§æ£€æŸ¥ï¼Œä½†ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬åªåšåŸºæœ¬æ£€æŸ¥
                if (data) {
                    resultElement.textContent += '   âœ… æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥é€šè¿‡\n';
                } else {
                    resultElement.textContent += '   âš ï¸ æ— æ³•æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§\n';
                    resultElement.className = 'test-result warning';
                }
                
                // è¯Šæ–­å®Œæˆ
                await new Promise(resolve => setTimeout(resolve, 500));
                progressBar.style.width = '100%';
                progressBar.textContent = '100%';
                
                resultElement.textContent += '\nè¯Šæ–­å®Œæˆï¼\n';
                
                if (resultElement.className === 'test-result') {
                    resultElement.className = 'test-result success';
                }
            }
            
            // å¼ºåˆ¶åŒæ­¥
            async function forceSync() {
                const resultElement = document.getElementById('diagnostic-result');
                resultElement.className = 'test-result';
                resultElement.textContent = 'æ­£åœ¨å¼ºåˆ¶åŒæ­¥...\n';
                
                try {
                    await syncManager.forcSync();
                    resultElement.textContent += 'âœ… å¼ºåˆ¶åŒæ­¥æˆåŠŸ\n';
                    resultElement.className = 'test-result success';
                    updateSyncTime();
                    updateLocalVersion();
                } catch (e) {
                    resultElement.textContent += `âŒ å¼ºåˆ¶åŒæ­¥å¤±è´¥: ${e.message}\n`;
                    resultElement.className = 'test-result error';
                }
            }
            
            // è‡ªåŠ¨ä¿®å¤
            async function autoFix() {
                const resultElement = document.getElementById('diagnostic-result');
                resultElement.className = 'test-result';
                resultElement.textContent = 'æ­£åœ¨è‡ªåŠ¨ä¿®å¤...\n';
                
                try {
                    // å°è¯•ä¿®å¤æ•°æ®é—®é¢˜
                    if (typeof dataFixer.fixAllIssues === 'function') {
                        await dataFixer.fixAllIssues();
                        resultElement.textContent += 'âœ… æ•°æ®ä¿®å¤å®Œæˆ\n';
                    }
                    
                    // å¼ºåˆ¶åŒæ­¥
                    await syncManager.forcSync();
                    resultElement.textContent += 'âœ… å¼ºåˆ¶åŒæ­¥æˆåŠŸ\n';
                    
                    resultElement.textContent += 'âœ… è‡ªåŠ¨ä¿®å¤å®Œæˆ\n';
                    resultElement.className = 'test-result success';
                    updateSyncTime();
                    updateLocalVersion();
                } catch (e) {
                    resultElement.textContent += `âŒ è‡ªåŠ¨ä¿®å¤å¤±è´¥: ${e.message}\n`;
                    resultElement.className = 'test-result error';
                }
            }
            
            // æ£€æŸ¥ä¸€è‡´æ€§
            function checkConsistency() {
                const resultElement = document.getElementById('consistency-result');
                resultElement.className = 'test-result';
                resultElement.textContent = 'æ­£åœ¨æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§...\n';
                
                const data = localStorage.getItem('taskManagerData');
                if (!data) {
                    resultElement.textContent += 'âŒ æ— æœ¬åœ°æ•°æ®\n';
                    resultElement.className = 'test-result error';
                    return;
                }
                
                try {
                    const parsedData = JSON.parse(data);
                    
                    // æ£€æŸ¥å¿…è¦çš„å­—æ®µ
                    const requiredFields = ['version', 'tasks', 'taskTemplates', 'completionHistory'];
                    const missingFields = requiredFields.filter(field => !parsedData.hasOwnProperty(field));
                    
                    if (missingFields.length > 0) {
                        resultElement.textContent += `âŒ ç¼ºå°‘å¿…è¦å­—æ®µ: ${missingFields.join(', ')}\n`;
                        resultElement.className = 'test-result error';
                    } else {
                        resultElement.textContent += 'âœ… æ‰€æœ‰å¿…è¦å­—æ®µéƒ½å­˜åœ¨\n';
                        
                        // æ£€æŸ¥ä»»åŠ¡æ¨¡æ¿å’Œä»»åŠ¡åˆ—è¡¨æ˜¯å¦ä¸€è‡´
                        if (parsedData.taskTemplates && parsedData.taskTemplates.daily) {
                            if (JSON.stringify(parsedData.taskTemplates.daily) === JSON.stringify(parsedData.tasks)) {
                                resultElement.textContent += 'âœ… ä»»åŠ¡æ¨¡æ¿å’Œä»»åŠ¡åˆ—è¡¨ä¸€è‡´\n';
                            } else {
                                resultElement.textContent += 'âš ï¸ ä»»åŠ¡æ¨¡æ¿å’Œä»»åŠ¡åˆ—è¡¨ä¸ä¸€è‡´\n';
                                resultElement.className = 'test-result warning';
                            }
                        }
                        
                        // æ£€æŸ¥ç‰ˆæœ¬å·
                        if (parsedData.version === '4.2.3') {
                            resultElement.textContent += 'âœ… ç‰ˆæœ¬å·æ­£ç¡®\n';
                        } else {
                            resultElement.textContent += `âš ï¸ ç‰ˆæœ¬å·ä¸æ˜¯æœ€æ–°: ${parsedData.version}\n`;
                            resultElement.className = 'test-result warning';
                        }
                        
                        if (resultElement.className === 'test-result') {
                            resultElement.textContent += '\nâœ… æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥é€šè¿‡\n';
                            resultElement.className = 'test-result success';
                        }
                    }
                } catch (e) {
                    resultElement.textContent += `âŒ æ•°æ®æ ¼å¼é”™è¯¯: ${e.message}\n`;
                    resultElement.className = 'test-result error';
                }
            }
            
            // ä¿®å¤æ•°æ®
            function repairData() {
                const resultElement = document.getElementById('consistency-result');
                resultElement.className = 'test-result';
                resultElement.textContent = 'æ­£åœ¨ä¿®å¤æ•°æ®...\n';
                
                const data = localStorage.getItem('taskManagerData');
                if (!data) {
                    resultElement.textContent += 'âŒ æ— æœ¬åœ°æ•°æ®ï¼Œæ— æ³•ä¿®å¤\n';
                    resultElement.className = 'test-result error';
                    return;
                }
                
                try {
                    let parsedData = JSON.parse(data);
                    let modified = false;
                    
                    // ç¡®ä¿æ‰€æœ‰å¿…è¦å­—æ®µéƒ½å­˜åœ¨
                    const requiredFields = {
                        'version': '4.2.3',
                        'tasks': [],
                        'taskTemplates': { daily: [] },
                        'completionHistory': {},
                        'taskTimes': {},
                        'focusRecords': {}
                    };
                    
                    for (const [field, defaultValue] of Object.entries(requiredFields)) {
                        if (!parsedData.hasOwnProperty(field)) {
                            parsedData[field] = defaultValue;
                            modified = true;
                            resultElement.textContent += `âœ… æ·»åŠ äº†ç¼ºå¤±å­—æ®µ: ${field}\n`;
                        }
                    }
                    
                    // ç¡®ä¿ç‰ˆæœ¬å·æ­£ç¡®
                    if (parsedData.version !== '4.2.3') {
                        resultElement.textContent += `âœ… æ›´æ–°ç‰ˆæœ¬å·: ${parsedData.version} -> 4.2.3\n`;
                        parsedData.version = '4.2.3';
                        modified = true;
                    }
                    
                    // ç¡®ä¿ä»»åŠ¡æ¨¡æ¿å’Œä»»åŠ¡åˆ—è¡¨ä¸€è‡´
                    if (parsedData.taskTemplates && parsedData.tasks) {
                        if (JSON.stringify(parsedData.taskTemplates.daily) !== JSON.stringify(parsedData.tasks)) {
                            parsedData.taskTemplates.daily = [...parsedData.tasks];
                            resultElement.textContent += 'âœ… åŒæ­¥ä»»åŠ¡æ¨¡æ¿å’Œä»»åŠ¡åˆ—è¡¨\n';
                            modified = true;
                        }
                    }
                    
                    if (modified) {
                        localStorage.setItem('taskManagerData', JSON.stringify(parsedData));
                        resultElement.textContent += '\nâœ… æ•°æ®ä¿®å¤å®Œæˆå¹¶ä¿å­˜\n';
                        resultElement.className = 'test-result success';
                        updateLocalVersion();
                    } else {
                        resultElement.textContent += '\nâœ… æ•°æ®æ— éœ€ä¿®å¤\n';
                        resultElement.className = 'test-result success';
                    }
                } catch (e) {
                    resultElement.textContent += `âŒ ä¿®å¤æ•°æ®å¤±è´¥: ${e.message}\n`;
                    resultElement.className = 'test-result error';
                }
            }
            
            // æ¸…é™¤æœ¬åœ°æ•°æ®
            function clearLocalData() {
                const resultElement = document.getElementById('advanced-result');
                
                if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æœ¬åœ°æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
                    try {
                        localStorage.removeItem('taskManagerData');
                        localStorage.removeItem('lastSyncTime');
                        
                        resultElement.textContent = 'âœ… æœ¬åœ°æ•°æ®å·²æ¸…é™¤\n';
                        resultElement.className = 'test-result success';
                        
                        updateSyncTime();
                        updateLocalVersion();
                    } catch (e) {
                        resultElement.textContent = `âŒ æ¸…é™¤æ•°æ®å¤±è´¥: ${e.message}\n`;
                        resultElement.className = 'test-result error';
                    }
                } else {
                    resultElement.textContent = 'æ“ä½œå·²å–æ¶ˆ\n';
                    resultElement.className = 'test-result';
                }
            }
            
            // é‡ç½®åŒæ­¥çŠ¶æ€
            function resetSync() {
                const resultElement = document.getElementById('advanced-result');
                
                if (confirm('ç¡®å®šè¦é‡ç½®åŒæ­¥çŠ¶æ€å—ï¼Ÿè¿™å°†æ¸…é™¤åŒæ­¥æ—¶é—´æˆ³ä½†ä¿ç•™æ•°æ®ã€‚')) {
                    try {
                        localStorage.removeItem('lastSyncTime');
                        
                        resultElement.textContent = 'âœ… åŒæ­¥çŠ¶æ€å·²é‡ç½®\n';
                        resultElement.className = 'test-result success';
                        
                        updateSyncTime();
                    } catch (e) {
                        resultElement.textContent = `âŒ é‡ç½®åŒæ­¥çŠ¶æ€å¤±è´¥: ${e.message}\n`;
                        resultElement.className = 'test-result error';
                    }
                } else {
                    resultElement.textContent = 'æ“ä½œå·²å–æ¶ˆ\n';
                    resultElement.className = 'test-result';
                }
            }
            
            // å¯¼å‡ºè°ƒè¯•ä¿¡æ¯
            function exportDebug() {
                const resultElement = document.getElementById('advanced-result');
                
                try {
                    const debugInfo = {
                        version: '4.2.3',
                        timestamp: new Date().toISOString(),
                        userAgent: navigator.userAgent,
                        online: navigator.onLine,
                        localStorage: {}
                    };
                    
                    // æ”¶é›†localStorageä¸­çš„æ•°æ®
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        try {
                            debugInfo.localStorage[key] = localStorage.getItem(key);
                        } catch (e) {
                            debugInfo.localStorage[key] = `[Error reading value: ${e.message}]`;
                        }
                    }
                    
                    // åˆ›å»ºä¸‹è½½é“¾æ¥
                    const dataStr = JSON.stringify(debugInfo, null, 2);
                    const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                    
                    const exportFileDefaultName = `task-manager-debug-${new Date().toISOString().slice(0, 10)}.json`;
                    
                    const linkElement = document.createElement('a');
                    linkElement.setAttribute('href', dataUri);
                    linkElement.setAttribute('download', exportFileDefaultName);
                    linkElement.click();
                    
                    resultElement.textContent = 'âœ… è°ƒè¯•ä¿¡æ¯å·²å¯¼å‡º\n';
                    resultElement.className = 'test-result success';
                } catch (e) {
                    resultElement.textContent = `âŒ å¯¼å‡ºè°ƒè¯•ä¿¡æ¯å¤±è´¥: ${e.message}\n`;
                    resultElement.className = 'test-result error';
                }
            }
            
            // åˆå§‹åŒ–é¡µé¢
            updateOnlineStatus();
            updateSyncTime();
            updateLocalVersion();
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
            
            document.getElementById('run-diagnostic').addEventListener('click', runDiagnostic);
            document.getElementById('force-sync').addEventListener('click', forceSync);
            document.getElementById('auto-fix').addEventListener('click', autoFix);
            document.getElementById('check-consistency').addEventListener('click', checkConsistency);
            document.getElementById('repair-data').addEventListener('click', repairData);
            document.getElementById('clear-local-data').addEventListener('click', clearLocalData);
            document.getElementById('reset-sync').addEventListener('click', resetSync);
            document.getElementById('export-debug').addEventListener('click', exportDebug);
        });
    </script>
</body>
</html>